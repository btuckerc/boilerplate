{{- if eq .chezmoi.os "darwin" -}}
#!/usr/bin/env bash
# Managed by chezmoi - https://github.com/btuckerc/boilerplate
# Install Homebrew packages on macOS
# This script runs whenever the Brewfile changes

set -euo pipefail

echo "üì¶ Installing Homebrew packages..."

# Ensure Homebrew is available
if ! command -v brew >/dev/null 2>&1; then
    echo "‚ùå Error: Homebrew not found. Run prerequisite script first."
    exit 1
fi

# Get the chezmoi source directory to find the Brewfile
# .chezmoi.sourceDir already points to .../boilerplate/home due to .chezmoiroot
BREWFILE="{{ .chezmoi.sourceDir }}/Brewfile"

if [ ! -f "$BREWFILE" ]; then
    echo "‚ùå Error: Brewfile not found at $BREWFILE"
    exit 1
fi

# Run brew bundle
echo "üìã Using Brewfile: $BREWFILE"
brew bundle install --file="$BREWFILE"

echo "‚úÖ Homebrew packages installed successfully!"
{{- end -}}
